{% comment %}
============= Warning: DO NOT EDIT THIS FILE! =============

Editing this file could break Cross Sell app functionality. 
This file might be overwritten.
version: xsell-v2.1.4 [Do not remove version info]
Support website: http://help.csell.co

============= Warning: DO NOT EDIT THIS FILE! =============
{% endcomment %}

{% if template contains 'product' %}
  {% assign cscurrentpage = 'product' %}
{% endif %}
{% if template == 'cart' %}
  {% assign cscurrentpage = 'cart' %}
  {% assign cssmartcart = 'on' %}
{% endif %}

{% assign cartitems = ''%}
{% for item in cart.items %}
  {% if forloop.first == true %}
    {% capture cartitems %}{{ item.product.handle }}{% endcapture %}
  {% else %}
    {% capture cartitems %}{{ cartitems }},{{ item.product.handle }}{% endcapture %}
  {% endif %}
{% endfor %}

{% if shop.metafields.shopCrosssell.settings != null %}
<style>
  .xs-clearfix:after {
    content: ".";
    visibility: hidden;
    display: block;
    height: 0;
    clear: both;
  }
</style>
<div class="xs-clearfix"></div>
<div id="cross-sell"></div>
<div class="xs-clearfix"></div>

<script type="text/javascript" charset="utf-8">

  var xsellSettings = xsellSettings || {};
  {% if cartitems %}
  var cartitems = '{{ cartitems }}';
  xsellSettings.cartitems = cartitems.split(',');
  {% else %}
  xsellSettings.cartitems = [];
  {% endif %}

  xsellSettings.shopMetafields = eval({{ shop.metafields.shopCrosssell | json }});
  xsellSettings.crosssellsettings = eval({{ shop.metafields.shopCrosssell.settings | json }});
  xsellSettings.money_format = {{ shop.money_format | json }};
  xsellSettings.xsmainproducthandle = '{{ product.handle }}';
  xsellSettings.currentpagetype = '{{ cscurrentpage }}';
  xsellSettings.xsimagesize = 'large';

  xsellSettings.xsrandomizeproductpage = xsellSettings.crosssellsettings[0]['randomizeproductpage'];
  xsellSettings.xsrandomizecartpage = xsellSettings.crosssellsettings[0]['randomizecartpage'];
  xsellSettings.xsmustbeavailable = xsellSettings.crosssellsettings[0]['mustbeavailable'];
  xsellSettings.xshideifincart = xsellSettings.crosssellsettings[0]['hideifincart'];

  xsellSettings.xsdisplaycompareatprice = xsellSettings.crosssellsettings[0]['displaycompareatprice'];
  xsellSettings.xsdisplaysalebadge = xsellSettings.crosssellsettings[0]['displaysalebadge'];
  xsellSettings.xsdisplaypricevarieslabel = xsellSettings.crosssellsettings[0]['displaypricevarieslabel'];
  xsellSettings.xsdisplayvendor = xsellSettings.crosssellsettings[0]['displayvendor'];


  {% if cscurrentpage == 'product' %}
  //product specific settings
  var crossselltitleproductpage = xsellSettings.crosssellsettings[0]['titleproductpage'];
  var crossselltitleproductpagedefault = xsellSettings.crosssellsettings[0]['titleproductpagedefault'];
  var crosssellshowdefault = xsellSettings.crosssellsettings[0]['showdefault'];

  xsellSettings.crosssellmaxitems = xsellSettings.crosssellsettings[0]['productpagemaxitems'];
  {% else if cscurrentpage == 'cart' %}
    //cart/basket settings
  var crossselltitlecheckoutpage = xsellSettings.crosssellsettings[0]['titlecheckoutpage'];
  var crosssellshowcheckout = xsellSettings.crosssellsettings[0]['showcheckout'];

  xsellSettings.crosssellmaxitems = xsellSettings.crosssellsettings[0]['checkoutpagemaxitems'];
  {% endif %}

</script>

{% endif %}

<script type="text/javascript" charset="utf-8">
var xsproductsData = '';
xsellSettings.xstitle = "";
  {% if cscurrentpage == 'product' %}

  if(crosssellshowdefault != '4'){
    {% if product.metafields.productDetails.crosssell != null %}
    xsellSettings.product_crosssells = eval({{ product.metafields.productDetails.crosssell | json }});
    xsproductsData = xsellSettings.product_crosssells;
    if(crossselltitleproductpage.length){
      xsellSettings.xstitle = crossselltitleproductpage;
    }
    {% endif %}
  }
  if(crosssellshowdefault == '1' || (crosssellshowdefault == '2' && xsproductsData == '')){
    {% if shop.metafields.shopCrosssell.default != null %}
    xsellSettings.default_crosssells = eval({{ shop.metafields.shopCrosssell.default | json }});
    xsproductsData = xsellSettings.default_crosssells;
    if(crossselltitleproductpagedefault.length){
      xsellSettings.xstitle = crossselltitleproductpagedefault;
    }
    {% endif %}
  }
{% else %}
  if(crosssellshowcheckout == '2'){
    {% if shop.metafields.shopCrosssell.settings != null %}
      {% assign settings = shop.metafields.shopCrosssell.settings | replace: ' ', '' %}
      {% if settings contains '"cssmartcart":"off"' %}
      {% capture cssmartcart %}'off'{% endcapture %}
      {% endif %}

      {% if cssmartcart == 'on' %}
        {% for item in cart.items %}
          {% assign csitem = all_products[item.product.handle] %}
        {% if csitem.metafields.productDetails.crosssell != null %}
            {% assign csitemmetafield = csitem.metafields.productDetails.crosssell %}
            {% capture cssmartcartxsells %}{{ csitemmetafield }}{% endcapture %}
            {% break %}
          {% endif %}
        {% endfor %}
      {% endif %}
    
      {% if shop.metafields.shopCrosssell.checkout != null %}
        {% assign csdefaultcartxsells = shop.metafields.shopCrosssell.checkout %}
      {% endif %}

      {% if cssmartcart == 'on' and cssmartcartxsells != null %}
        {% assign _xsproductsData = cssmartcartxsells %}
      {% else %}
        {% assign _xsproductsData = csdefaultcartxsells %}
      {% endif %}
    {% endif %}
    
    xsproductsData = eval({{ _xsproductsData | json }});

    if(crossselltitlecheckoutpage.length){
      xsellSettings.xstitle = crossselltitlecheckoutpage;
    }
  }
{% endif %}

if(xsproductsData){
  if (xsproductsData.length && (xsproductsData[0] !== '')){
    window.xsellData = {
      data: xsproductsData,
      settings: xsellSettings
    }
  } else {
    var elem = document.getElementById("cross-sell");
    if (elem){
      elem.parentNode.removeChild(elem);
    }
  }
}

</script>